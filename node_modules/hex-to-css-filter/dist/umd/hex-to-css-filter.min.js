!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).HexToCSSFilter={})}(this,function(t){"use strict";var h=(e.prototype.set=function(t,e,s){this.r=this.clamp(t),this.g=this.clamp(e),this.b=this.clamp(s)},e.prototype.hueRotate=function(t){t=(t=void 0===t?0:t)/180*Math.PI;var e=Math.sin(t),t=Math.cos(t);this.multiply([.213+.787*t-.213*e,.715-.715*t-.715*e,.072-.072*t+.928*e,.213-.213*t+.143*e,.715+.285*t+.14*e,.072-.072*t-.283*e,.213-.213*t-.787*e,.715-.715*t+.715*e,.072+.928*t+.072*e])},e.prototype.grayscale=function(t){this.multiply([.2126+.7874*(1-(t=void 0===t?1:t)),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)])},e.prototype.sepia=function(t){this.multiply([.393+.607*(1-(t=void 0===t?1:t)),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)])},e.prototype.saturate=function(t){this.multiply([.213+.787*(t=void 0===t?1:t),.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t])},e.prototype.multiply=function(t){var e=this.clamp(this.r*t[0]+this.g*t[1]+this.b*t[2]),s=this.clamp(this.r*t[3]+this.g*t[4]+this.b*t[5]),t=this.clamp(this.r*t[6]+this.g*t[7]+this.b*t[8]);this.r=e,this.g=s,this.b=t},e.prototype.brightness=function(t){this.linear(t=void 0===t?1:t)},e.prototype.contrast=function(t){this.linear(t=void 0===t?1:t,-.5*t+.5)},e.prototype.linear=function(t,e){this.r=this.clamp(this.r*(t=void 0===t?1:t)+255*(e=void 0===e?0:e)),this.g=this.clamp(this.g*t+255*e),this.b=this.clamp(this.b*t+255*e)},e.prototype.invert=function(t){this.r=this.clamp(255*((t=void 0===t?1:t)+this.r/255*(1-2*t))),this.g=this.clamp(255*(t+this.g/255*(1-2*t))),this.b=this.clamp(255*(t+this.b/255*(1-2*t)))},e.prototype.hsl=function(){var t=this.r/255,e=this.g/255,s=this.b/255,r=Math.max(t,e,s),i=Math.min(t,e,s),o=0,a=(r+i)/2;if(r===i)return{h:0,s:0,l:100*a};var n=r-i;return r===t?o=(e-s)/n+(e<s?6:0):r===e?o=(s-t)/n+2:r===s&&(o=(t-e)/n+4),{h:100*(o/=6),s:100*(.5<a?n/(2-r-i):n/(r+i)),l:100*a}},e.prototype.clamp=function(t){return Math.min(Math.max(t,0),255)},e);function e(t,e,s){this.r=0,this.g=0,this.b=0,this.set(t,e,s)}var l=(s.prototype.solve=function(){var t=this.solveNarrow(this.solveWide());return{values:t.values,called:t.called,loss:t.loss,filter:this.css(t.values)}},s.prototype.solveWide=function(){for(var t=[60,180,18e3,600,1.2,1.2],e={loss:1/0},s=0;e.loss>this.options.acceptanceLossPercentage;){var r=this.spsa({A:5,a:t,c:15,values:[50,20,3750,50,100,100],maxTriesInLoop:1e3});if(r.loss<e.loss&&(e=r),(s+=1)>=this.options.maxChecks)break}return Object.assign({},e,{called:s})},s.prototype.solveNarrow=function(t){var e=t.loss,s=e+1;return this.spsa({A:e,a:[.25*s,.25*s,s,.25*s,.2*s,.2*s],c:2,values:t.values,maxTriesInLoop:500,called:t.called})},s.prototype.fixValueByFilterIDX=function(t,e){var s=100;return 2===e?s=7500:4!==e&&5!==e||(s=200),3===e?s<t?t%=s:t<0&&(t=s+t%s):t<0?t=0:s<t&&(t=s),t},s.prototype.spsa=function(t){for(var e=t.A,s=t.a,r=t.c,i=t.values,o=t.maxTriesInLoop,a=void 0===o?500:o,t=t.called,t=void 0===t?0:t,n=null,h=1/0,l=new Array(6),c=new Array(6),p=new Array(6),u=0;u<a;u++){for(var f=r/Math.pow(u+1,.16666666666666666),v=0;v<6;v++)l[v]=.5<Math.random()?1:-1,c[v]=i[v]+f*l[v],p[v]=i[v]-f*l[v];for(var d=this.loss(c)-this.loss(p),v=0;v<6;v++){var y=d/(2*f)*l[v],b=s[v]/Math.pow(e+u+1,1);i[v]=this.fixValueByFilterIDX(i[v]-b*y,v)}var g=this.loss(i);g<h&&(n=i.slice(0),h=g)}return{values:n,loss:h,called:t}},s.prototype.loss=function(t){var e=this.reusedColor;e.set(0,0,0),e.invert(t[0]/100),e.sepia(t[1]/100),e.saturate(t[2]/100),e.hueRotate(3.6*t[3]),e.brightness(t[4]/100),e.contrast(t[5]/100);t=e.hsl();return Math.abs(e.r-this.target.r)+Math.abs(e.g-this.target.g)+Math.abs(e.b-this.target.b)+Math.abs(t.h-this.targetHSL.h)+Math.abs(t.s-this.targetHSL.s)+Math.abs(t.l-this.targetHSL.l)},s.prototype.css=function(s){function t(t,e){return void 0===e&&(e=1),Math.round(s[t]*e)}return["invert("+t(0)+"%)","sepia("+t(1)+"%)","saturate("+t(2)+"%)","hue-rotate("+t(3,3.6)+"deg)","brightness("+t(4)+"%)","contrast("+t(5)+"%);"].join(" ")},s);function s(t,e){this.target=t,this.targetHSL=t.hsl(),this.options=Object.assign({},{acceptanceLossPercentage:5,maxChecks:15},e),this.reusedColor=new h(0,0,0)}function c(t){return!isNaN(parseFloat(t))&&isFinite(t)}var p={};t.clearCache=function(t){t?p[t]&&delete p[t]:p={}},t.hexToCSSFilter=function(t,e){var s,r,i,o,a,n;if(void 0===e&&(e={}),p[t]&&!e.forceFilterRecalculation)return Object.assign({},p[t],{cache:!0});try{if(r=(s=function(t,e){var s="function"==typeof Symbol&&t[Symbol.iterator];if(!s)return t;var r,i,o=s.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}return a}(4===(n=t).length?[parseInt("0x"+n[1]+n[1]),parseInt("0x"+n[2]+n[2]),parseInt("0x"+n[3]+n[3])]:7===n.length?[parseInt("0x"+n[1]+n[2]),parseInt("0x"+n[3]+n[4]),parseInt("0x"+n[5]+n[6])]:[],3))[0],i=s[1],o=s[2],!c(r)||!c(i)||!c(o))throw new Error("hextToRgb returned an invalid value for '"+t+"'");a=new h(Number(r),Number(i),Number(o))}catch(t){throw new Error("Color value should be in HEX format. "+t)}e=new l(a,Object.assign({},{acceptanceLossPercentage:5,maxChecks:30,forceFilterRecalculation:!1},e));return p[t]=Object.assign({},e.solve(),{hex:t,rgb:[r,i,o],cache:!1})},Object.defineProperty(t,"__esModule",{value:!0})});